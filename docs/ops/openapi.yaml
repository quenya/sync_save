openapi: 3.0.3
info:
  title: sync_save API
  version: "0.1.0"
  description: Web Codex MVP API for OAuth auth, user-scoped games, and save revisions.
servers:
  - url: http://localhost:3000
paths:
  /auth/providers:
    get:
      summary: Supported OAuth providers
      responses:
        200:
          description: provider list
          content:
            application/json:
              example:
                providers: [google, facebook]

  /auth/oauth/{provider}:
    post:
      summary: Mock OAuth callback (mock tokens for current sprint)
      parameters:
        - in: path
          name: provider
          required: true
          schema:
            type: string
            enum: [google, facebook]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [providerUserId, email, name]
              properties:
                providerUserId:
                  type: string
                email:
                  type: string
                  format: email
                name:
                  type: string
      responses:
        200:
          description: authenticated session
        400:
          description: bad request

  /auth/refresh:
    post:
      summary: Rotate access token with refresh token
      responses:
        200:
          description: new tokens
        401:
          description: invalid refresh token

  /auth/logout:
    post:
      summary: Revoke current user sessions
      security:
        - bearerAuth: []
      responses:
        204:
          description: logged out
        401:
          description: unauthorized

  /me:
    get:
      summary: Current user profile
      security:
        - bearerAuth: []
      responses:
        200:
          description: user
        401:
          description: unauthorized
    delete:
      summary: Soft-delete user and revoke data
      security:
        - bearerAuth: []
      responses:
        204:
          description: deleted
        401:
          description: unauthorized

  /games:
    get:
      summary: List games for authenticated user
      security:
        - bearerAuth: []
      responses:
        200:
          description: games list
        401:
          description: unauthorized
    post:
      summary: Create a game and save path
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, savePath]
              properties:
                name:
                  type: string
                savePath:
                  type: string
      responses:
        201:
          description: created
        400:
          description: invalid payload
        401:
          description: unauthorized

  /games/{gameId}:
    get:
      summary: Get game detail (user-scoped)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: gameId
          required: true
          schema:
            type: integer
      responses:
        200:
          description: game
        401:
          description: unauthorized
        403:
          description: forbidden
        404:
          description: not found

  /games/{gameId}/revisions:
    get:
      summary: List game revisions
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: gameId
          required: true
          schema:
            type: integer
      responses:
        200:
          description: revision list
    post:
      summary: Upload revision metadata (mock upload)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: gameId
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [checksum, sizeBytes]
              properties:
                checksum:
                  type: string
                sizeBytes:
                  type: integer
                  minimum: 1
                clientUpdatedAt:
                  type: string
                note:
                  type: string
      responses:
        201:
          description: revision created
        409:
          description: revision conflict
        400:
          description: invalid request

  /games/{gameId}/revisions/latest:
    get:
      summary: Latest revision
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: gameId
          required: true
          schema:
            type: integer
      responses:
        200:
          description: latest revision
        404:
          description: no revision

  /games/{gameId}/revisions/{revisionId}/download:
    post:
      summary: Prepare revision download
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: gameId
          required: true
          schema:
            type: integer
        - in: path
          name: revisionId
          required: true
          schema:
            type: integer
      responses:
        200:
          description: mock artifact metadata
        404:
          description: not found

  /games/{gameId}/revisions/{revisionId}/resolve:
    post:
      summary: Resolve conflict for specific revision
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: gameId
          required: true
          schema:
            type: integer
        - in: path
          name: revisionId
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                strategy:
                  type: string
                  enum: [overwrite-server, prefer-server]
      responses:
        200:
          description: conflict resolved

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: random
